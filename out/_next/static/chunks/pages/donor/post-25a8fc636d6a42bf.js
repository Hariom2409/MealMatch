(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[573],{2705:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/donor/post",function(){return s(957)}])},2602:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return o},noSSR:function(){return r}});let a=s(8754);s(5893),s(7294);let l=a._(s(5491));function n(e){return{default:(null==e?void 0:e.default)||e}}function r(e,t){return delete t.webpack,delete t.modules,e(t)}function o(e,t){let s=l.default,a={loading:e=>{let{error:t,isLoading:s,pastDelay:a}=e;return null}};e instanceof Promise?a.loader=()=>e:"function"==typeof e?a.loader=e:"object"==typeof e&&(a={...a,...e});let o=(a={...a,...t}).loader;return(a.loadableGenerated&&(a={...a,...a.loadableGenerated},delete a.loadableGenerated),"boolean"!=typeof a.ssr||a.ssr)?s({...a,loader:()=>null!=o?o().then(n):Promise.resolve(n(()=>null))}):(delete a.webpack,delete a.modules,r(s,a))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1159:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return a}});let a=s(8754)._(s(7294)).default.createContext(null)},5491:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return m}});let a=s(8754)._(s(7294)),l=s(1159),n=[],r=[],o=!1;function i(e){let t=e(),s={loading:!0,loaded:null,error:null};return s.promise=t.then(e=>(s.loading=!1,s.loaded=e,e)).catch(e=>{throw s.loading=!1,s.error=e,e}),s}class c{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,t){let s=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),n=null;function i(){if(!n){let t=new c(e,s);n={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return n.promise()}if(!o){let e=s.webpack?s.webpack():s.modules;e&&r.push(t=>{for(let s of e)if(t.includes(s))return i()})}function d(e,t){!function(){i();let e=a.default.useContext(l.LoadableContext);e&&Array.isArray(s.modules)&&s.modules.forEach(t=>{e(t)})}();let r=a.default.useSyncExternalStore(n.subscribe,n.getCurrentValue,n.getCurrentValue);return a.default.useImperativeHandle(t,()=>({retry:n.retry}),[]),a.default.useMemo(()=>{var t;return r.loading||r.error?a.default.createElement(s.loading,{isLoading:r.loading,pastDelay:r.pastDelay,timedOut:r.timedOut,error:r.error,retry:n.retry}):r.loaded?a.default.createElement((t=r.loaded)&&t.default?t.default:t,e):null},[e,r])}return d.preload=()=>i(),d.displayName="LoadableComponent",a.default.forwardRef(d)}(i,e)}function u(e,t){let s=[];for(;e.length;){let a=e.pop();s.push(a(t))}return Promise.all(s).then(()=>{if(e.length)return u(e,t)})}d.preloadAll=()=>new Promise((e,t)=>{u(n).then(e,t)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let s=()=>(o=!0,t());u(r,e).then(s,s)})),window.__NEXT_PRELOADREADY=d.preloadReady;let m=d},6911:function(e,t,s){"use strict";var a=s(3967),l=s.n(a),n=s(7294),r=s(7400),o=s(8964),i=s(5893);function c(e,t){let{min:s,now:a,max:n,label:r,visuallyHidden:o,striped:c,animated:d,className:u,style:m,variant:h,bsPrefix:p,...g}=e;return(0,i.jsx)("div",{ref:t,...g,role:"progressbar",className:l()(u,"".concat(p,"-bar"),{["bg-".concat(h)]:h,["".concat(p,"-bar-animated")]:d,["".concat(p,"-bar-striped")]:d||c}),style:{width:"".concat(Math.round((a-s)/(n-s)*1e5)/1e3,"%"),...m},"aria-valuenow":a,"aria-valuemin":s,"aria-valuemax":n,children:o?(0,i.jsx)("span",{className:"visually-hidden",children:r}):r})}let d=n.forwardRef((e,t)=>{let{isChild:s=!1,...a}=e,d={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...a};if(d.bsPrefix=(0,r.vE)(d.bsPrefix,"progress"),s)return c(d,t);let{min:u,now:m,max:h,label:p,visuallyHidden:g,striped:x,animated:f,bsPrefix:j,variant:y,className:b,children:v,...N}=d;return(0,i.jsx)("div",{ref:t,...N,className:l()(b,j),children:v?(0,o.UI)(v,e=>(0,n.cloneElement)(e,{isChild:!0})):c({min:u,now:m,max:h,label:p,visuallyHidden:g,striped:x,animated:f,bsPrefix:j,variant:y},t)})});d.displayName="ProgressBar",t.Z=d},4268:function(e,t,s){"use strict";var a=s(5893);s(7294);var l=s(7375),n=s(9101),r=s(8070),o=s(2121),i=s(6720),c=s(1664),d=s.n(c),u=s(6197);t.Z=e=>{let{children:t,requireVerified:s=!0}=e,{currentUser:c,isEmailVerified:m}=(0,u.a)();return c?s&&!m()?(0,a.jsx)(l.Z,{className:"py-5",children:(0,a.jsx)(n.Z,{className:"justify-content-center",children:(0,a.jsx)(r.Z,{md:6,children:(0,a.jsx)(o.Z,{className:"shadow-sm",children:(0,a.jsxs)(o.Z.Body,{className:"p-4 text-center",children:[(0,a.jsx)("h4",{children:"Email Verification Required"}),(0,a.jsxs)("p",{className:"text-muted mb-3",children:["Please verify your email address ",(0,a.jsx)("strong",{children:c.email})," to continue."]}),(0,a.jsx)("div",{className:"d-grid gap-2",children:(0,a.jsx)(d(),{href:"/verify-email",passHref:!0,children:(0,a.jsx)(i.Z,{variant:"primary",children:"Verify Email"})})})]})})})})}):(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)(l.Z,{className:"py-5",children:(0,a.jsx)(n.Z,{className:"justify-content-center",children:(0,a.jsx)(r.Z,{md:6,children:(0,a.jsx)(o.Z,{className:"shadow-sm",children:(0,a.jsxs)(o.Z.Body,{className:"p-4 text-center",children:[(0,a.jsx)("h4",{children:"Please Log In"}),(0,a.jsx)("p",{className:"text-muted",children:"You need to be logged in to access this page."}),(0,a.jsx)(d(),{href:"/login",passHref:!0,children:(0,a.jsx)(i.Z,{variant:"primary",children:"Go to Login"})})]})})})})})}},957:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var a=s(5893),l=s(7294),n=s(6346),r=s(7375),o=s(6236),i=s(525),c=s(6720),d=s(6911),u=s(9101),m=s(8070),h=s(2121),p=s(1163),g=s(5675),x=s.n(g),f=s(5152),j=s.n(f),y=s(3628),b=s(6197),v=s(2914),N=s(9834),w=s(4268),Z=s(4298),C=s.n(Z);let k=j()(()=>s.e(921).then(s.bind(s,2921)),{loadableGenerated:{webpack:()=>[2921]},ssr:!1,loading:()=>(0,a.jsx)("div",{style:{height:"300px",width:"100%",backgroundColor:"#f8f9fa",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(n.Z,{animation:"border"})})}),_=()=>{let e=(0,p.useRouter)(),{currentUser:t}=(0,b.a)(),[s,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(null),[w,Z]=(0,l.useState)(!1),[_,S]=(0,l.useState)(1),[P,E]=(0,l.useState)("idle"),[I,T]=(0,l.useState)(0),[D,F]=(0,l.useState)(""),[L,A]=(0,l.useState)(""),[G,M]=(0,l.useState)(""),[O,B]=(0,l.useState)(""),[R,V]=(0,l.useState)(""),[z,U]=(0,l.useState)(""),[J,q]=(0,l.useState)(""),[K,H]=(0,l.useState)(""),[Q,X]=(0,l.useState)([]),[Y,W]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(!1),[et,es]=(0,l.useState)(!1),[ea,el]=(0,l.useState)(""),[en,er]=(0,l.useState)(null),[eo,ei]=(0,l.useState)(null),[ec,ed]=(0,l.useState)(null),[eu,em]=(0,l.useState)(3),[eh,ep]=(0,l.useState)(!0),[eg,ex]=(0,l.useState)(!0),[ef,ej]=(0,l.useState)(!0),[ey,eb]=(0,l.useState)(""),ev=new Date().toISOString().split("T")[0],[eN,ew]=(0,l.useState)(!1),[eZ,eC]=(0,l.useState)({lat:0,lng:0}),[ek,e_]=(0,l.useState)({lat:0,lng:0}),[eS,eP]=(0,l.useState)(!1),[eE,eI]=(0,l.useState)(!1),eT=(0,l.useRef)(null),[eD,eF]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!t){e.push("/login?redirect=/donor/post");return}if("donor"!==t.role){e.push("/");return}t.address&&B(t.address);let s=new Date;V(s.toISOString().split("T")[0]),U(s.toTimeString().substring(0,5)),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{e_({lat:e.coords.latitude,lng:e.coords.longitude}),eC({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e),e_({lat:0,lng:0})})},[t,e]);let eL=e=>(ed(null),e.size>5242880)?(ed("Image is too large. Maximum size is 5MB."),!1):!!["image/jpeg","image/png","image/jpg","image/webp"].includes(e.type)||(ed("Only JPEG, PNG, and WebP images are supported."),!1),eA=e=>{Q.includes(e)?X(Q.filter(t=>t!==e)):X([...Q,e])},eG=()=>{let e=0,t=setInterval(()=>{(e+=Math.floor(10*Math.random())+1)>95&&(clearInterval(t),e=95),T(e)},800);return()=>clearInterval(t)},eM=e=>{if(console.log("Map clicked event received:",e),e.latLng){let t={lat:e.latLng.lat(),lng:e.latLng.lng()};if(console.log("Setting new coordinates:",t),eC(t),window.google&&window.google.maps)try{new window.google.maps.Geocoder().geocode({location:t},(e,t)=>{console.log("Geocoding results:",e),console.log("Geocoding status:",t),"OK"===t&&(null==e?void 0:e[0])&&(console.log("Setting location to:",e[0].formatted_address),B(e[0].formatted_address))})}catch(e){console.error("Error during geocoding:",e)}}},eO=e=>{window.open("https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(e)),"_blank")};(0,l.useEffect)(()=>{if(eD&&eT.current&&window.google)try{let e=new window.google.maps.places.Autocomplete(eT.current,{types:["address"]});e.addListener("place_changed",()=>{let t=e.getPlace();if(console.log("Selected place:",t),t.formatted_address&&B(t.formatted_address),t.geometry&&t.geometry.location){let e={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};eC(e),e_(e)}})}catch(e){console.error("Error initializing Places Autocomplete:",e)}},[eD,eT.current]);let eB=async e=>{e.preventDefault(),g(!0),j(null),E("idle");try{if(!D||!L||!G||!O||!J||!K)throw Error("Please fill in all required fields");let e=new Date("".concat(R,"T").concat(z)),s=new Date("".concat(J,"T").concat(K));if(s<=new Date)throw Error("Expiry time must be in the future");console.log("Current user in post creation:",t),console.log("User ID for post:",null==t?void 0:t.id);let a={title:D,quantity:L,description:G,location:{address:O,lat:eZ.lat,lng:eZ.lng},preparedTime:e,expiryTime:s,isVegetarian:Y,isNonVegetarian:$,isGlutenFree:et,postedBy:(null==t?void 0:t.id)||"",postedByName:(null==t?void 0:t.name)||"",checklist:{hygieneRating:eu,properStorage:eh,safeTemperature:eg,handlingProcedures:ef,notes:ey}};if(en){E("uploading");let e=eG();try{console.log("Saving food post to Firebase with image:",a);let t=await (0,N.d4)(a,en);e(),T(100),E("success"),console.log("Food post created with ID:",t),Z(!0)}catch(t){throw e(),E("error"),Error("Image upload failed: ".concat(t.message||"Unknown error"))}}else{console.log("Saving food post to Firebase without image:",a);let e=await (0,N.d4)(a);console.log("Food post created with ID:",e),Z(!0)}}catch(e){console.error("Error in form submission:",e),j(e.message||"Failed to create food post. Please try again.")}finally{g(!1)}},eR=()=>{S(_+1)},eV=()=>{S(_-1)};return t&&"donor"===t.role?((0,l.useEffect)(()=>{eN&&0===ek.lat&&0===ek.lng&&(console.log("No map center set, trying to get current location"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};console.log("Setting map center to current location:",t),e_(t),0===eZ.lat&&0===eZ.lng&&eC(t)},e=>{console.error("Error getting location:",e)}))},[eN,ek,eZ]),(0,a.jsxs)(y.Z,{title:"Post Food Donation - MealMatch",description:"Share your excess food with those in need",children:[(0,a.jsx)(C(),{src:"https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyCQQMVUciK2SC_p2M87oiViiv8Nez4wlok","&libraries=places"),onLoad:()=>{console.log("Places script loaded"),eF(!0)},strategy:"afterInteractive"}),(0,a.jsx)(r.Z,{className:"py-5",children:(0,a.jsx)(u.Z,{className:"justify-content-center",children:(0,a.jsx)(m.Z,{md:10,lg:8,children:(0,a.jsx)(h.Z,{className:"shadow-sm border-0",children:(0,a.jsx)(h.Z.Body,{className:"p-4",children:w?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"success-icon mb-3",children:(0,a.jsx)(v.l_A,{size:50,className:"text-success"})}),(0,a.jsx)("h2",{className:"mb-3",children:"Food Posted Successfully!"}),(0,a.jsx)("p",{className:"mb-4",children:"Your food donation has been posted and is now visible to recipients. Thank you for helping reduce food waste!"}),(0,a.jsxs)("div",{className:"d-flex justify-content-center gap-3",children:[(0,a.jsx)(c.Z,{variant:"primary",onClick:()=>e.push("/donor/dashboard"),children:"View My Listings"}),(0,a.jsx)(c.Z,{variant:"outline-primary",onClick:()=>{F(""),A(""),M(""),B(""),X([]),W(!1),ee(!1),es(!1),el(""),er(null),ei(null),S(1),Z(!1),j(null)},children:"Post Another Donation"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"mb-4 text-center",children:"Post Food Donation"}),f&&(0,a.jsx)(i.Z,{variant:"danger",className:"mb-4",children:f}),(0,a.jsxs)(o.Z,{onSubmit:eB,children:[1===_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"step-indicator mb-4",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,a.jsxs)("div",{className:"step active",children:[(0,a.jsx)("span",{className:"step-number",children:"1"}),(0,a.jsx)("span",{className:"step-title",children:"Basic Info"})]}),(0,a.jsxs)("div",{className:"step",children:[(0,a.jsx)("span",{className:"step-number",children:"2"}),(0,a.jsx)("span",{className:"step-title",children:"Time & Location"})]}),(0,a.jsxs)("div",{className:"step",children:[(0,a.jsx)("span",{className:"step-number",children:"3"}),(0,a.jsx)("span",{className:"step-title",children:"Safety Checklist"})]})]})}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Title ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)(o.Z.Control,{type:"text",value:D,onChange:e=>F(e.target.value),placeholder:"E.g., Fresh Bread Loaves, Leftover Catering Food",required:!0})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Quantity ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)(o.Z.Control,{type:"text",value:L,onChange:e=>A(e.target.value),placeholder:"E.g., 5 loaves, 10 servings, 2kg",required:!0})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Description ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)(o.Z.Control,{as:"textarea",rows:3,value:G,onChange:e=>M(e.target.value),placeholder:"Describe the food items, condition, why you're donating, etc.",required:!0})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Food Types"}),(0,a.jsx)("div",{className:"d-flex flex-wrap gap-2",children:["fruits","vegetables","dairy","bakery","prepared meals","canned goods","grains","beverages","snacks","desserts"].map(e=>(0,a.jsx)(c.Z,{variant:Q.includes(e)?"primary":"outline-primary",size:"sm",onClick:()=>eA(e),className:"text-capitalize",children:e},e))})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Dietary Information"}),(0,a.jsxs)("div",{className:"d-flex flex-wrap gap-3",children:[(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"vegetarian",label:"Vegetarian",checked:Y,onChange:e=>W(e.target.checked)}),(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"non-vegetarian",label:"Non-Vegetarian",checked:$,onChange:e=>ee(e.target.checked)}),(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"gluten-free",label:"Gluten-Free",checked:et,onChange:e=>es(e.target.checked)})]})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Food Photo"}),(0,a.jsxs)("div",{className:"d-flex flex-column",children:[(0,a.jsx)(o.Z.Control,{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:e=>{let t=e.target.files;if(t&&t.length>0){let s=t[0];if(!eL(s)){e.target.value="",er(null),ei(null);return}er(s);let a=new FileReader;a.onloadend=()=>{ei(a.result)},a.readAsDataURL(s)}},className:"mb-2",disabled:s}),ec&&(0,a.jsxs)(i.Z,{variant:"danger",className:"my-2 py-2",children:[(0,a.jsx)(v.gJy,{className:"me-2"}),ec]}),(0,a.jsx)("small",{className:"text-muted mb-2",children:"Recommended: Upload a clear image of the food. Max size: 5MB. Supported formats: JPEG, PNG, WebP."}),eo&&(0,a.jsx)("div",{className:"mt-2 position-relative",style:{height:"200px"},children:(0,a.jsx)(x(),{src:eo,alt:"Food preview",fill:!0,style:{objectFit:"cover"},className:"rounded"})})]})]})]}),(0,a.jsx)("div",{className:"d-flex justify-content-end",children:(0,a.jsx)(c.Z,{variant:"success",onClick:eR,children:"Next: Time & Location"})})]}),2===_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"step-indicator mb-4",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,a.jsxs)("div",{className:"step completed",children:[(0,a.jsx)("span",{className:"step-number",children:"1"}),(0,a.jsx)("span",{className:"step-title",children:"Basic Info"})]}),(0,a.jsxs)("div",{className:"step active",children:[(0,a.jsx)("span",{className:"step-number",children:"2"}),(0,a.jsx)("span",{className:"step-title",children:"Time & Location"})]}),(0,a.jsxs)("div",{className:"step",children:[(0,a.jsx)("span",{className:"step-number",children:"3"}),(0,a.jsx)("span",{className:"step-title",children:"Safety Checklist"})]})]})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h5",{className:"mb-3",children:[(0,a.jsx)(v.IiJ,{className:"me-2"})," Time Information"]}),(0,a.jsxs)(u.Z,{children:[(0,a.jsx)(m.Z,{md:6,children:(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Prepared Date"}),(0,a.jsx)(o.Z.Control,{type:"date",value:R,onChange:e=>V(e.target.value),max:ev})]})}),(0,a.jsx)(m.Z,{md:6,children:(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Prepared Time"}),(0,a.jsx)(o.Z.Control,{type:"time",value:z,onChange:e=>U(e.target.value)})]})})]}),(0,a.jsxs)(u.Z,{children:[(0,a.jsx)(m.Z,{md:6,children:(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Expiry Date ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)(o.Z.Control,{type:"date",value:J,onChange:e=>q(e.target.value),min:ev,required:!0})]})}),(0,a.jsx)(m.Z,{md:6,children:(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Expiry Time ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsx)(o.Z.Control,{type:"time",value:K,onChange:e=>H(e.target.value),required:!0})]})})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h5",{className:"mb-3",children:[(0,a.jsx)(v.Nh4,{className:"me-2"})," Pickup Location"]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsxs)(o.Z.Label,{children:["Address ",(0,a.jsx)("span",{className:"text-danger",children:"*"})]}),(0,a.jsxs)("div",{className:"d-flex gap-2 mb-2",children:[(0,a.jsx)(o.Z.Control,{type:"text",value:O,onChange:e=>{let t=e.target.value;B(t),t&&t.trim().length},placeholder:"Enter the pickup location address",required:!0,ref:eT}),(0,a.jsxs)(c.Z,{variant:eN?"primary":"outline-primary",onClick:()=>ew(!eN),children:[(0,a.jsx)(v.Kth,{className:"me-2"}),eN?"Hide Map":"Show Map"]})]}),(()=>{if(!eN)return null;let e="AIzaSyCQQMVUciK2SC_p2M87oiViiv8Nez4wlok";if(console.log("Google Maps API Key (first few chars):",e?e.substring(0,5)+"...":"missing"),!e)return(0,a.jsxs)("div",{style:{height:"300px",width:"100%",backgroundColor:"#f8f9fa",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px",border:"1px solid #ddd",borderRadius:"8px",color:"#dc3545"},children:[(0,a.jsxs)("div",{style:{fontSize:"18px",marginBottom:"10px"},children:[(0,a.jsx)(v.gJy,{className:"me-2"})," Google Maps API Key Not Configured"]}),(0,a.jsxs)("div",{style:{textAlign:"center",maxWidth:"400px"},children:["To use this feature, you need to add a valid Google Maps API key to your ",(0,a.jsx)("code",{children:".env.local"})," file.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"Update the ",(0,a.jsx)("code",{children:"NEXT_PUBLIC_GOOGLE_MAPS_API_KEY"})," value with your actual API key."]})]});let t=0!==ek.lat||0!==ek.lng?ek:{lat:40.712776,lng:-74.005974};return console.log("Rendering map with center:",t),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{height:"300px",width:"100%",marginBottom:"1rem"},children:(0,a.jsx)(k,{googleMapsApiKey:e,mapContainerStyle:{height:"100%",width:"100%"},center:t,zoom:15,onClick:eM,onLoad:()=>{console.log("Map loaded successfully"),eP(!0)},markerPosition:0!==eZ.lat?eZ:void 0})}),(0,a.jsxs)("div",{className:"text-muted mb-3 small",children:[(0,a.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,a.jsx)(v.DAO,{className:"me-2 text-primary"}),(0,a.jsx)("span",{children:"Click on the map to open Google Maps in a new tab and select a precise location."})]}),(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)(v.U41,{className:"me-2 text-primary"}),(0,a.jsx)("span",{children:"You can also find a location by typing an address in the Address field above."})]})]}),(0,a.jsxs)(c.Z,{variant:"outline-primary",size:"sm",className:"mt-2",onClick:()=>eO(O),children:[(0,a.jsx)(v.Nh4,{className:"me-2"})," Find on Map"]})]})})()]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Pickup Instructions"}),(0,a.jsx)(o.Z.Control,{as:"textarea",rows:2,value:ea,onChange:e=>el(e.target.value),placeholder:"E.g., Ring doorbell, call when arriving, etc."})]})]})]}),(0,a.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,a.jsx)(c.Z,{variant:"outline-secondary",onClick:eV,children:"Back"}),(0,a.jsx)(c.Z,{variant:"success",onClick:eR,children:"Next: Safety Checklist"})]})]}),"3"===String(_)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"step-indicator mb-4",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,a.jsxs)("div",{className:"step completed",children:[(0,a.jsx)("span",{className:"step-number",children:"1"}),(0,a.jsx)("span",{className:"step-title",children:"Basic Info"})]}),(0,a.jsxs)("div",{className:"step completed",children:[(0,a.jsx)("span",{className:"step-number",children:"2"}),(0,a.jsx)("span",{className:"step-title",children:"Time & Location"})]}),(0,a.jsxs)("div",{className:"step active",children:[(0,a.jsx)("span",{className:"step-number",children:"3"}),(0,a.jsx)("span",{className:"step-title",children:"Safety Checklist"})]})]})}),(0,a.jsxs)("div",{className:"safety-checklist-info mb-4",children:[(0,a.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[(0,a.jsx)(v.DAO,{className:"me-2 text-primary",size:20}),(0,a.jsx)("h5",{className:"mb-0",children:"Food Safety Declaration"})]}),(0,a.jsx)("p",{className:"text-muted",children:"Please confirm the following statements regarding the safety of the food you're donating. This helps build trust between donors and recipients."})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Hygiene Rating (1-5)"}),(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)(o.Z.Range,{min:1,max:5,value:eu,onChange:e=>em(parseInt(e.target.value))}),(0,a.jsx)("span",{className:"ms-2 rating-value",children:eu})]}),(0,a.jsx)(o.Z.Text,{className:"text-muted",children:"Rate the hygiene conditions in which the food was prepared/stored"})]}),(0,a.jsx)(o.Z.Group,{className:"mb-3",children:(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"proper-storage",label:"Food has been properly stored",checked:eh,onChange:e=>ep(e.target.checked)})}),(0,a.jsx)(o.Z.Group,{className:"mb-3",children:(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"safe-temperature",label:"Food has been kept at safe temperatures",checked:eg,onChange:e=>ex(e.target.checked)})}),(0,a.jsx)(o.Z.Group,{className:"mb-3",children:(0,a.jsx)(o.Z.Check,{type:"checkbox",id:"handling-procedures",label:"Proper food handling procedures were followed",checked:ef,onChange:e=>ej(e.target.checked)})}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Additional Safety Notes"}),(0,a.jsx)(o.Z.Control,{as:"textarea",rows:2,value:ey,onChange:e=>eb(e.target.value),placeholder:"Any additional information about food safety"})]})]}),(0,a.jsxs)(a.Fragment,{children:["3"===String(_)&&(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[(0,a.jsx)(c.Z,{variant:"outline-secondary",onClick:eV,disabled:s,children:"Back"}),(0,a.jsx)(c.Z,{variant:"success",type:"submit",disabled:s,className:"d-flex align-items-center",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Posting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.l_A,{className:"me-2"})," Post Food Donation"]})})]}),"uploading"===P&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("p",{className:"text-center mb-1",children:["Uploading image... ",I,"%"]}),(0,a.jsx)(d.Z,{animated:!0,variant:"success",now:I,label:"".concat(I,"%"),className:"mt-2"}),(0,a.jsx)("p",{className:"text-muted text-center mt-2 small",children:"This may take a moment depending on your internet connection"})]})]})]})]})]})})})})})})]})):(0,a.jsx)(y.Z,{title:"Loading - MealMatch",children:(0,a.jsx)(r.Z,{className:"py-5 text-center",children:(0,a.jsx)(n.Z,{animation:"border",variant:"success"})})})};function S(){return(0,a.jsx)(w.Z,{requireVerified:!0,children:(0,a.jsx)(_,{})})}},9834:function(e,t,s){"use strict";s.d(t,{E4:function(){return o},d4:function(){return r},hj:function(){return i},oS:function(){return c}});var a=s(109),l=s(6650),n=s(8882);let r=async(e,t)=>{console.log("Creating food post with data:",e),console.log("Posted by user ID:",e.postedBy);try{let s="";if(t){console.log("Uploading image to Firebase Storage");let e=Date.now(),a=Math.random().toString(36).substring(2,10),r="".concat(e,"-").concat(a,"-").concat(t.name),o=(0,l.iH)(n.tO,"food-images/".concat(r)),i=new Promise(async(e,s)=>{try{if(t.size>5242880)throw Error("Image file is too large. Maximum size is 5MB.");let s={contentType:t.type,cacheControl:"public,max-age=86400"},a=await (0,l.KV)(o,t,s);console.log("Image uploaded successfully");let n=await (0,l.Jt)(a.ref);e(n)}catch(e){console.error("Error in image upload process:",e),s(e)}}),c=new Promise((e,t)=>{setTimeout(()=>{t(Error("Image upload timed out. Please try again with a smaller image."))},6e4)});try{s=await Promise.race([i,c]),console.log("Image uploaded, URL:",s)}catch(e){throw console.error("Image upload failed:",e),e}}let r={...e,imageUrl:s,status:"available",createdAt:(0,a.Bt)(),preparedTime:a.EK.fromDate(e.preparedTime),expiryTime:a.EK.fromDate(e.expiryTime)};console.log("Adding food post to Firestore with final data:",r);let o=await (0,a.ET)((0,a.hJ)(n.db,"foodPosts"),r);return console.log("Adding safety checklist to Firestore"),await (0,a.ET)((0,a.hJ)(n.db,"safetyChecklists"),{...e.checklist,foodId:o.id,createdAt:(0,a.Bt)()}),console.log("Food post created successfully with ID:",o.id),o.id}catch(e){throw console.error("Error creating food post:",e),e}},o=async e=>{try{console.log("Getting food posts from Firestore with filters:",e);let t=(0,a.hJ)(n.db,"foodPosts"),s=[];(null==e?void 0:e.status)&&(s.push((0,a.ar)("status","==",e.status)),console.log("Added status filter:",e.status)),(null==e?void 0:e.foodType)==="vegetarian"?(s.push((0,a.ar)("isVegetarian","==",!0)),console.log("Added vegetarian filter")):(null==e?void 0:e.foodType)==="non-vegetarian"?(s.push((0,a.ar)("isNonVegetarian","==",!0)),console.log("Added non-vegetarian filter")):(null==e?void 0:e.foodType)==="gluten-free"&&(s.push((0,a.ar)("isGlutenFree","==",!0)),console.log("Added gluten-free filter")),(null==e?void 0:e.userId)&&(console.log("Adding postedBy filter with user ID:",e.userId),s.push((0,a.ar)("postedBy","==",e.userId))),s.push((0,a.Xo)("createdAt","desc")),console.log("Added orderBy createdAt desc"),console.log("Final query constraints:",JSON.stringify(s));let l=await (0,a.PL)((0,a.IO)(t,...s));console.log("Found ".concat(l.size," food posts in Firestore")),0===l.size&&console.log("No posts found. Collection might be empty or filters too restrictive");let r=[];for(let t of l.docs){let s=t.data(),l=(0,a.IO)((0,a.hJ)(n.db,"safetyChecklists"),(0,a.ar)("foodId","==",t.id),(0,a.b9)(1)),o=await (0,a.PL)(l),i=null;if(!o.empty){let e=o.docs[0].data();i={id:o.docs[0].id,foodId:t.id,hygieneRating:e.hygieneRating,properStorage:e.properStorage,safeTemperature:e.safeTemperature,handlingProcedures:e.handlingProcedures,notes:e.notes}}let c={id:t.id,title:s.title,quantity:s.quantity,description:s.description,imageUrl:s.imageUrl,preparedTime:s.preparedTime.toDate(),expiryTime:s.expiryTime.toDate(),location:s.location,isVegetarian:s.isVegetarian,isNonVegetarian:s.isNonVegetarian,isGlutenFree:s.isGlutenFree,postedBy:s.postedBy,postedByName:s.postedByName,status:s.status,createdAt:s.createdAt?s.createdAt.toDate():new Date,checklist:i};if(null==e?void 0:e.nearExpiry){let e=new Date,t=c.expiryTime,s=new Date(e.getTime()+108e5);t<s&&t>e&&r.push(c)}else r.push(c)}return r}catch(e){throw console.error("Error fetching food posts:",e),e}},i=async e=>{try{console.log("Deleting food post with ID:",e),await (0,a.oe)((0,a.JU)(n.db,"foodPosts",e));let t=(0,a.IO)((0,a.hJ)(n.db,"safetyChecklists"),(0,a.ar)("foodId","==",e),(0,a.b9)(1)),s=await (0,a.PL)(t);s.empty||await (0,a.oe)((0,a.JU)(n.db,"safetyChecklists",s.docs[0].id)),console.log("Food post and related documents deleted successfully")}catch(e){throw console.error("Error deleting food post:",e),e}},c=async(e,t)=>{try{console.log("Updating food post ".concat(e," status to: ").concat(t));let s=(0,a.JU)(n.db,"foodPosts",e);await (0,a.r7)(s,{status:t}),console.log("Food post status updated successfully")}catch(e){throw console.error("Error updating food post status:",e),e}}},5152:function(e,t,s){e.exports=s(2602)},4298:function(e,t,s){e.exports=s(3381)}},function(e){e.O(0,[445,999,330,728,697,628,888,774,179],function(){return e(e.s=2705)}),_N_E=e.O()}]);