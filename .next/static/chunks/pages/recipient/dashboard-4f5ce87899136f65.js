(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[796],{8341:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/recipient/dashboard",function(){return t(3317)}])},3280:function(e,a,t){"use strict";var s=t(3967),i=t.n(s),r=t(7294),l=t(7400),n=t(5893);let o=r.forwardRef((e,a)=>{let{bsPrefix:t,bg:s="primary",pill:r=!1,text:o,className:d,as:c="span",...m}=e,u=(0,l.vE)(t,"badge");return(0,n.jsx)(c,{ref:a,...m,className:i()(d,u,r&&"rounded-pill",o&&"text-".concat(o),s&&"bg-".concat(s))})});o.displayName="Badge",a.Z=o},7228:function(e,a,t){"use strict";t.d(a,{Z:function(){return E}});var s,i=t(3967),r=t.n(i),l=t(9351),n=t(3004),o=t(7216),d=t(99);function c(e){if((!s&&0!==s||e)&&n.Z){var a=document.createElement("div");a.style.position="absolute",a.style.top="-9999px",a.style.width="50px",a.style.height="50px",a.style.overflow="scroll",document.body.appendChild(a),s=a.offsetWidth-a.clientWidth,document.body.removeChild(a)}return s}var m=t(7294),u=t(1176),h=t(5654),p=t(4305),g=t(6981),x=t(5040),f=t(3730),y=t(7400),b=t(5893);let v=m.forwardRef((e,a)=>{let{className:t,bsPrefix:s,as:i="div",...l}=e;return s=(0,y.vE)(s,"modal-body"),(0,b.jsx)(i,{ref:a,className:r()(t,s),...l})});v.displayName="ModalBody";var j=t(5307);let N=m.forwardRef((e,a)=>{let{bsPrefix:t,className:s,contentClassName:i,centered:l,size:n,fullscreen:o,children:d,scrollable:c,...m}=e;t=(0,y.vE)(t,"modal");let u="".concat(t,"-dialog"),h="string"==typeof o?"".concat(t,"-fullscreen-").concat(o):"".concat(t,"-fullscreen");return(0,b.jsx)("div",{...m,ref:a,className:r()(u,s,n&&"".concat(t,"-").concat(n),l&&"".concat(u,"-centered"),c&&"".concat(u,"-scrollable"),o&&h),children:(0,b.jsx)("div",{className:r()("".concat(t,"-content"),i),children:d})})});N.displayName="ModalDialog";let w=m.forwardRef((e,a)=>{let{className:t,bsPrefix:s,as:i="div",...l}=e;return s=(0,y.vE)(s,"modal-footer"),(0,b.jsx)(i,{ref:a,className:r()(t,s),...l})});w.displayName="ModalFooter";var Z=t(602);let C=m.forwardRef((e,a)=>{let{bsPrefix:t,className:s,closeLabel:i="Close",closeButton:l=!1,...n}=e;return t=(0,y.vE)(t,"modal-header"),(0,b.jsx)(Z.Z,{ref:a,...n,className:r()(s,t),closeLabel:i,closeButton:l})});C.displayName="ModalHeader";let S=(0,t(9106).Z)("h4"),B=m.forwardRef((e,a)=>{let{className:t,bsPrefix:s,as:i=S,...l}=e;return s=(0,y.vE)(s,"modal-title"),(0,b.jsx)(i,{ref:a,className:r()(t,s),...l})});function k(e){return(0,b.jsx)(f.Z,{...e,timeout:null})}function T(e){return(0,b.jsx)(f.Z,{...e,timeout:null})}B.displayName="ModalTitle";let D=m.forwardRef((e,a)=>{let{bsPrefix:t,className:s,style:i,dialogClassName:f,contentClassName:v,children:w,dialogAs:Z=N,"data-bs-theme":C,"aria-labelledby":S,"aria-describedby":B,"aria-label":D,show:E=!1,animation:F=!0,backdrop:R=!0,keyboard:A=!0,onEscapeKeyDown:I,onShow:z,onHide:M,container:P,autoFocus:O=!0,enforceFocus:L=!0,restoreFocus:V=!0,restoreFocusOptions:H,onEntered:_,onExit:U,onExiting:W,onEnter:q,onEntering:G,onExited:J,backdropClassName:K,manager:X,...Y}=e,[Q,$]=(0,m.useState)({}),[ee,ea]=(0,m.useState)(!1),et=(0,m.useRef)(!1),es=(0,m.useRef)(!1),ei=(0,m.useRef)(null),[er,el]=(0,m.useState)(null),en=(0,h.Z)(a,el),eo=(0,u.Z)(M),ed=(0,y.SC)();t=(0,y.vE)(t,"modal");let ec=(0,m.useMemo)(()=>({onHide:eo}),[eo]);function em(){return X||(0,x.t)({isRTL:ed})}function eu(e){if(!n.Z)return;let a=em().getScrollbarWidth()>0,t=e.scrollHeight>(0,o.Z)(e).documentElement.clientHeight;$({paddingRight:a&&!t?c():void 0,paddingLeft:!a&&t?c():void 0})}let eh=(0,u.Z)(()=>{er&&eu(er.dialog)});!function(e){let a=function(e){let a=(0,m.useRef)(e);return a.current=e,a}(e);(0,m.useEffect)(()=>()=>a.current(),[])}(()=>{(0,d.Z)(window,"resize",eh),null==ei.current||ei.current()});let ep=()=>{et.current=!0},eg=e=>{et.current&&er&&e.target===er.dialog&&(es.current=!0),et.current=!1},ex=()=>{ea(!0),ei.current=(0,p.Z)(er.dialog,()=>{ea(!1)})},ef=e=>{e.target===e.currentTarget&&ex()},ey=e=>{if("static"===R){ef(e);return}if(es.current||e.target!==e.currentTarget){es.current=!1;return}null==M||M()},eb=(0,m.useCallback)(e=>(0,b.jsx)("div",{...e,className:r()("".concat(t,"-backdrop"),K,!F&&"show")}),[F,K,t]),ev={...i,...Q};return ev.display="block",(0,b.jsx)(j.Z.Provider,{value:ec,children:(0,b.jsx)(g.Z,{show:E,ref:en,backdrop:R,container:P,keyboard:!0,autoFocus:O,enforceFocus:L,restoreFocus:V,restoreFocusOptions:H,onEscapeKeyDown:e=>{A?null==I||I(e):(e.preventDefault(),"static"===R&&ex())},onShow:z,onHide:M,onEnter:(e,a)=>{e&&eu(e),null==q||q(e,a)},onEntering:(e,a)=>{null==G||G(e,a),(0,l.ZP)(window,"resize",eh)},onEntered:_,onExit:e=>{null==ei.current||ei.current(),null==U||U(e)},onExiting:W,onExited:e=>{e&&(e.style.display=""),null==J||J(e),(0,d.Z)(window,"resize",eh)},manager:em(),transition:F?k:void 0,backdropTransition:F?T:void 0,renderBackdrop:eb,renderDialog:e=>(0,b.jsx)("div",{role:"dialog",...e,style:ev,className:r()(s,t,ee&&"".concat(t,"-static"),!F&&"show"),onClick:R?ey:void 0,onMouseUp:eg,"data-bs-theme":C,"aria-label":D,"aria-labelledby":S,"aria-describedby":B,children:(0,b.jsx)(Z,{...Y,onMouseDown:ep,className:f,contentClassName:v,children:w})})})})});D.displayName="Modal";var E=Object.assign(D,{Body:v,Header:C,Title:B,Footer:w,Dialog:N,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150})},3317:function(e,a,t){"use strict";t.r(a);var s=t(5893),i=t(7294),r=t(7375),l=t(6346),n=t(525),o=t(6720),d=t(9101),c=t(8070),m=t(6236),u=t(2121),h=t(3280),p=t(7228),g=t(1163),x=t(3628),f=t(6197),y=t(2914),b=t(9834),v=t(5675),j=t.n(v);let N={card:{transition:"all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1)",transform:"translateY(0)",borderRadius:"16px",overflow:"hidden",backgroundColor:"#ffffff",border:"none",boxShadow:"0 4px 24px rgba(149, 157, 165, 0.15)"},hoverCard:{transform:"translateY(-12px)",boxShadow:"0 24px 38px rgba(149, 157, 165, 0.18), 0 9px 12px rgba(149, 157, 165, 0.13)"},pillBadge:{borderRadius:"50px",padding:"0.5rem 1rem",fontWeight:"600",fontSize:"0.75rem",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(6px)",backgroundColor:"rgba(25, 135, 84, 0.9)",color:"white",border:"1px solid rgba(255, 255, 255, 0.18)"},secondaryBadge:{borderRadius:"50px",padding:"0.5rem 1rem",fontWeight:"600",fontSize:"0.75rem",letterSpacing:"0.5px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(6px)",backgroundColor:"rgba(108, 117, 125, 0.9)",color:"white",border:"1px solid rgba(255, 255, 255, 0.18)"},avatarCircle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",width:"42px",height:"42px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.07)",transition:"all 0.2s ease",backgroundColor:"rgba(13, 110, 253, 0.1)",border:"1px solid rgba(13, 110, 253, 0.05)"},avatarCircleWarning:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",width:"42px",height:"42px",boxShadow:"0 4px 10px rgba(0, 0, 0, 0.07)",transition:"all 0.2s ease",backgroundColor:"rgba(255, 193, 7, 0.1)",border:"1px solid rgba(255, 193, 7, 0.05)"},cardTitle:{fontSize:"1.4rem",marginBottom:"1rem",fontWeight:"700",color:"#2c3e50",lineHeight:"1.3",letterSpacing:"-0.01em"},cardText:{color:"#6c757d",fontSize:"0.95rem",lineHeight:"1.6",fontWeight:"400"},quantityBadge:{backgroundColor:"rgba(13, 202, 240, 0.1)",color:"#0dcaf0",fontWeight:"600",padding:"0.35rem 0.85rem",borderRadius:"50px",fontSize:"0.75rem",boxShadow:"0 2px 4px rgba(13, 202, 240, 0.1)"},distanceBadge:{display:"inline-flex",alignItems:"center",backgroundColor:"rgba(25, 135, 84, 0.1)",color:"#198754",fontWeight:"600",padding:"0.35rem 0.85rem",borderRadius:"50px",fontSize:"0.75rem",boxShadow:"0 2px 4px rgba(25, 135, 84, 0.1)"},cardImage:{borderRadius:"8px 8px 0 0",objectFit:"cover",height:"100%",width:"100%",transition:"transform 0.7s cubic-bezier(0.165, 0.84, 0.44, 1)"},cardImageHover:{transform:"scale(1.07)"},cardOverlay:{position:"absolute",inset:0,background:"linear-gradient(to bottom, rgba(0,0,0,0) 50%, rgba(0,0,0,0.7) 100%)",zIndex:1,borderRadius:"16px 16px 0 0"},claimButton:{borderRadius:"50px",padding:"0.6rem 1.2rem",fontWeight:"600",boxShadow:"0 4px 12px rgba(25, 135, 84, 0.25)",transition:"all 0.3s ease",background:"linear-gradient(135deg, #20b270 0%, #198754 100%)",border:"none"},claimButtonHover:{transform:"translateY(-2px)",boxShadow:"0 6px 18px rgba(25, 135, 84, 0.3)"},infoRow:{display:"flex",alignItems:"center",marginBottom:"1rem"}};a.default=()=>{let e=(0,g.useRouter)(),{currentUser:a}=(0,f.a)(),[t,v]=(0,i.useState)(!0),[w,Z]=(0,i.useState)(null),[C,S]=(0,i.useState)([]),[B,k]=(0,i.useState)([]),[T,D]=(0,i.useState)("grid"),[E,F]=(0,i.useState)(null),[R,A]=(0,i.useState)(!1),[I,z]=(0,i.useState)(""),[M,P]=(0,i.useState)(""),[O,L]=(0,i.useState)(""),[V,H]=(0,i.useState)([]),[_,U]=(0,i.useState)([]),[W,q]=(0,i.useState)(!1),[G,J]=(0,i.useState)(null),K=e=>{let a=Math.floor(Math.floor((new Date().getTime()-e.getTime())/1e3)/60),t=Math.floor(a/60),s=Math.floor(t/24);return s>0?"".concat(s," day").concat(s>1?"s":""," ago"):t>0?"".concat(t," hour").concat(t>1?"s":""," ago"):a>0?"".concat(a," minute").concat(a>1?"s":""," ago"):"just now"},X=e=>{let a=new Date,t=e.getTime()-a.getTime();if(t<=0)return"Expired";let s=Math.floor(Math.floor(t/1e3)/60),i=Math.floor(s/60),r=Math.floor(i/24);return r>0?"".concat(r," day").concat(r>1?"s":""):i>0?"".concat(i," hour").concat(i>1?"s":""):s>0?"".concat(s," minute").concat(s>1?"s":""):"Less than a minute"},Y=e=>{let a=new Set;return e.forEach(e=>{e.isVegetarian&&a.add("vegetarian"),e.isNonVegetarian&&a.add("non-vegetarian"),e.isGlutenFree&&a.add("gluten-free")}),Array.from(a)},Q=e=>{let a=[];e.isVegetarian&&a.push("vegetarian"),e.isNonVegetarian&&a.push("non-vegetarian"),e.isGlutenFree&&a.push("gluten-free");let{checklist:t,...s}=e;return{...s,distance:Math.round((14.5*Math.random()+.5)*10)/10,tags:a}};(0,i.useEffect)(()=>{if(!a){e.push("/login?redirect=/recipient/dashboard");return}if("ngo"!==a.role&&"donor"!==a.role&&"admin"!==a.role){e.push("/");return}$()},[a,e]);let $=async()=>{try{v(!0),console.log("Using dummy data for recipient dashboard");let e=[{id:"1",title:"Fresh Produce",quantity:"40 kg",description:"Mixed vegetables and fruits",postedByName:"Green Market",postedBy:"dummy-donor-1",location:{address:"123 Main Street",lat:37.7749,lng:-122.4194},expiryTime:new Date(Date.now()+864e5),preparedTime:new Date(Date.now()-108e5),createdAt:new Date(Date.now()-108e5),status:"available",isVegetarian:!0,isNonVegetarian:!1,isGlutenFree:!1,checklist:{id:"dummy-1",foodId:"1",hygieneRating:5,properStorage:!0,safeTemperature:!0,handlingProcedures:!0,notes:"Properly handled and stored"}},{id:"2",title:"Prepared Meals",quantity:"25 servings",description:"Pasta with marinara sauce",postedByName:"Italian Restaurant",postedBy:"dummy-donor-2",location:{address:"456 Oak Avenue",lat:37.7739,lng:-122.4312},expiryTime:new Date(Date.now()+18e6),preparedTime:new Date(Date.now()-36e5),createdAt:new Date(Date.now()-36e5),status:"available",isVegetarian:!1,isNonVegetarian:!0,isGlutenFree:!1,checklist:{id:"dummy-2",foodId:"2",hygieneRating:5,properStorage:!0,safeTemperature:!0,handlingProcedures:!0,notes:"Restaurant quality"}},{id:"3",title:"Bread Assortment",quantity:"30 loaves",description:"Various types of bread and pastries",postedByName:"Downtown Bakery",postedBy:"dummy-donor-3",location:{address:"789 Maple Road",lat:37.7729,lng:-122.4232},expiryTime:new Date(Date.now()+432e5),preparedTime:new Date(Date.now()-18e6),createdAt:new Date(Date.now()-18e6),status:"available",isVegetarian:!0,isNonVegetarian:!1,isGlutenFree:!1,checklist:{id:"dummy-3",foodId:"3",hygieneRating:5,properStorage:!0,safeTemperature:!0,handlingProcedures:!0,notes:"Fresh baked"}}].map(e=>Q(e));S(e),k(e);let a=Y(e);H(a),v(!1)}catch(e){console.error("Error loading food posts:",e),Z("Failed to load food donations. Please try again later."),v(!1)}};(0,i.useEffect)(()=>{if(!C.length)return;let e=[...C];if(M){let a=M.toLowerCase();e=e.filter(e=>{var t;return e.title.toLowerCase().includes(a)||e.description.toLowerCase().includes(a)||e.postedByName.toLowerCase().includes(a)||(null===(t=e.tags)||void 0===t?void 0:t.some(e=>e.toLowerCase().includes(a)))||!1})}""!==O&&(e=e.filter(e=>void 0!==e.distance&&e.distance<=O)),_.length>0&&(e=e.filter(e=>_.some(a=>{var t;return"vegetarian"===a?e.isVegetarian:"non-vegetarian"===a?e.isNonVegetarian:"gluten-free"===a?e.isGlutenFree:(null===(t=e.tags)||void 0===t?void 0:t.includes(a))||!1}))),k(e)},[M,O,_,C]);let ee=async()=>{if(E){q(!0);try{await (0,b.oS)(E.id,"claimed");let e=C.map(e=>e.id===E.id?{...e,status:"claimed",claimedBy:null==a?void 0:a.id,claimedAt:new Date}:e);S(e);let t=B.map(e=>e.id===E.id?{...e,status:"claimed",claimedBy:null==a?void 0:a.id,claimedAt:new Date}:e);k(t),A(!1),z(""),F(null)}catch(e){console.error("Error claiming food post:",e),Z("Failed to claim food donation. Please try again later.")}finally{q(!1)}}},ea=e=>{_.includes(e)?U(_.filter(a=>a!==e)):U([..._,e])};return t&&!C.length?(0,s.jsx)(x.Z,{title:"Loading - MealMatch",children:(0,s.jsxs)(r.Z,{className:"py-5 text-center",children:[(0,s.jsx)(l.Z,{animation:"border",variant:"success"}),(0,s.jsx)("p",{className:"mt-3",children:"Loading food donations..."})]})}):w&&!C.length?(0,s.jsx)(x.Z,{title:"Error - MealMatch",children:(0,s.jsx)(r.Z,{className:"py-5",children:(0,s.jsxs)(n.Z,{variant:"danger",children:[(0,s.jsx)(n.Z.Heading,{children:"Error"}),(0,s.jsx)("p",{children:w}),(0,s.jsx)(o.Z,{variant:"outline-danger",onClick:()=>window.location.reload(),children:"Try Again"})]})})}):(0,s.jsx)(x.Z,{title:"Available Donations - MealMatch",description:"Find and claim available food donations",children:(0,s.jsxs)(r.Z,{fluid:!0,className:"py-4",children:[(0,s.jsx)(d.Z,{className:"mb-4",children:(0,s.jsxs)(c.Z,{children:[(0,s.jsx)("h1",{className:"h3",children:"Available Food Donations"}),(0,s.jsx)("p",{className:"text-muted",children:"Find and claim food donations from local businesses and individuals."})]})}),(0,s.jsxs)(d.Z,{className:"mb-4",children:[(0,s.jsx)(c.Z,{md:6,lg:4,className:"mb-3 mb-md-0",children:(0,s.jsxs)("div",{className:"input-group",children:[(0,s.jsx)("span",{className:"input-group-text",children:(0,s.jsx)(y.U41,{})}),(0,s.jsx)(m.Z.Control,{type:"text",placeholder:"Search donations...",value:M,onChange:e=>P(e.target.value)})]})}),(0,s.jsx)(c.Z,{md:3,lg:2,className:"mb-3 mb-md-0",children:(0,s.jsxs)("div",{className:"input-group",children:[(0,s.jsx)("span",{className:"input-group-text",children:(0,s.jsx)(y.Nh4,{})}),(0,s.jsxs)(m.Z.Select,{value:""===O?"":O.toString(),onChange:e=>L(""===e.target.value?"":Number(e.target.value)),children:[(0,s.jsx)("option",{value:"",children:"Distance (Any)"}),(0,s.jsx)("option",{value:"1",children:"Within 1 km"}),(0,s.jsx)("option",{value:"3",children:"Within 3 km"}),(0,s.jsx)("option",{value:"5",children:"Within 5 km"}),(0,s.jsx)("option",{value:"10",children:"Within 10 km"})]})]})}),(0,s.jsx)(c.Z,{md:3,lg:2,className:"mb-3 mb-md-0",children:(0,s.jsxs)("div",{className:"d-flex",children:[(0,s.jsx)(o.Z,{variant:"grid"===T?"primary":"outline-primary",className:"me-2",onClick:()=>D("grid"),children:(0,s.jsx)(y.xyo,{})}),(0,s.jsx)(o.Z,{variant:"list"===T?"primary":"outline-primary",onClick:()=>D("list"),children:(0,s.jsx)(y.hON,{})})]})})]}),V.length>0&&(0,s.jsx)(d.Z,{className:"mb-4",children:(0,s.jsx)(c.Z,{children:(0,s.jsxs)("div",{className:"d-flex align-items-center flex-wrap",children:[(0,s.jsxs)("div",{className:"me-3 mb-2",children:[(0,s.jsx)(y.ulB,{className:"me-2"}),(0,s.jsx)("span",{children:"Filter by:"})]}),V.map(e=>(0,s.jsx)(o.Z,{size:"sm",variant:_.includes(e)?"primary":"outline-primary",className:"me-2 mb-2 text-capitalize",onClick:()=>ea(e),children:e},e))]})})}),0===B.length&&!t&&(0,s.jsxs)(n.Z,{variant:"info",className:"text-center",children:["No food donations found matching your criteria.",_.length>0||M||""!==O?(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(o.Z,{variant:"outline-primary",size:"sm",onClick:()=>{P(""),L(""),U([])},children:"Clear Filters"})}):null]}),"grid"===T&&B.length>0&&(0,s.jsx)(d.Z,{children:B.map(e=>(0,s.jsx)(c.Z,{md:6,lg:4,xl:3,className:"mb-4",children:(0,s.jsxs)(u.Z,{className:"h-100",style:{...N.card,...G===e.id?N.hoverCard:{}},onMouseEnter:()=>J(e.id),onMouseLeave:()=>J(null),children:[(0,s.jsxs)("div",{className:"position-relative",style:{height:"200px",overflow:"hidden"},children:[e.imageUrl?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:N.cardOverlay}),(0,s.jsx)(j(),{src:e.imageUrl,alt:e.title,fill:!0,style:{...N.cardImage,...G===e.id?N.cardImageHover:{}},className:"card-img-top"})]}):(0,s.jsxs)("div",{className:"bg-light d-flex align-items-center justify-content-center h-100 position-relative",children:[(0,s.jsx)("div",{style:N.cardOverlay}),(0,s.jsxs)("div",{className:"position-relative z-3 p-3 text-center",children:[(0,s.jsx)("div",{className:"bg-white rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"},children:(0,s.jsx)("span",{className:"material-symbols-outlined fs-2 text-secondary",children:"restaurant"})}),(0,s.jsx)("p",{className:"text-white mb-0 fw-semibold",children:"No image available"})]})]}),(0,s.jsx)("div",{className:"position-absolute top-0 end-0 m-3 z-2",children:(0,s.jsx)(h.Z,{style:"available"===e.status?N.pillBadge:N.secondaryBadge,className:"opacity-90",children:"available"===e.status?"Available":"Claimed"})}),(0,s.jsx)("div",{className:"position-absolute bottom-0 start-0 m-3 z-2",children:(0,s.jsx)("span",{style:N.quantityBadge,className:"d-inline-block",children:e.quantity})})]}),(0,s.jsxs)(u.Z.Body,{className:"d-flex flex-column p-4",children:[(0,s.jsx)(u.Z.Title,{style:N.cardTitle,children:e.title}),(0,s.jsx)(u.Z.Text,{style:N.cardText,className:"mb-4",children:e.description.length>100?"".concat(e.description.substring(0,100),"..."):e.description}),(0,s.jsxs)("div",{style:N.infoRow,children:[(0,s.jsx)("div",{style:N.avatarCircle,className:"me-3",children:(0,s.jsx)(y.Nh4,{className:"text-primary fs-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.85rem"},children:e.location&&"object"==typeof e.location?e.location.address:String(e.location)}),e.distance&&(0,s.jsxs)("div",{style:N.distanceBadge,className:"mt-1",children:[(0,s.jsx)(y.Nh4,{className:"me-1",style:{fontSize:"0.7rem"}})," ",e.distance," km"]})]})]}),(0,s.jsxs)("div",{style:N.infoRow,children:[(0,s.jsx)("div",{style:N.avatarCircleWarning,className:"me-3",children:(0,s.jsx)(y.IiJ,{className:"text-warning fs-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.85rem"},children:"Expires in"}),(0,s.jsx)("div",{className:"text-warning fw-bold",children:X(e.expiryTime)})]})]}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"mb-4",children:e.tags.map(e=>(0,s.jsx)(h.Z,{bg:"light",text:"dark",className:"me-2 mb-2 text-capitalize",style:N.pillBadge,children:e},e))}),(0,s.jsxs)("div",{className:"mt-auto",children:[(0,s.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[(0,s.jsx)("div",{className:"rounded-circle bg-primary bg-opacity-10 p-2 me-2",style:N.avatarCircle,children:(0,s.jsx)("span",{className:"text-primary fw-bold",children:e.postedByName.charAt(0)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-primary fw-semibold",children:e.postedByName}),(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:K(e.createdAt)})]})]}),(0,s.jsx)(o.Z,{variant:"available"===e.status?"success":"secondary",className:"w-100 py-2 d-flex align-items-center justify-content-center",onClick:()=>{F(e),A(!0)},disabled:"available"!==e.status,style:{..."available"===e.status?N.claimButton:{},..."available"===e.status&&G===e.id?N.claimButtonHover:{}},children:"available"===e.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"material-symbols-outlined me-2",children:"shopping_cart_checkout"}),"Claim Now"]}):"Already Claimed"})]})]})]})},e.id))}),"list"===T&&B.length>0&&(0,s.jsx)("div",{className:"list-view",children:B.map(e=>(0,s.jsx)(u.Z,{className:"mb-4",style:{...N.card,...G===e.id?N.hoverCard:{}},onMouseEnter:()=>J(e.id),onMouseLeave:()=>J(null),children:(0,s.jsx)(u.Z.Body,{className:"p-0",children:(0,s.jsxs)(d.Z,{className:"g-0",children:[(0,s.jsx)(c.Z,{md:3,className:"position-relative",style:{overflow:"hidden",borderRadius:"16px 0 0 16px"},children:e.imageUrl?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{...N.cardOverlay,borderRadius:"16px 0 0 16px"}}),(0,s.jsx)(j(),{src:e.imageUrl,alt:e.title,fill:!0,style:{...N.cardImage,borderRadius:"16px 0 0 16px",...G===e.id?N.cardImageHover:{}}}),(0,s.jsx)("div",{className:"position-absolute top-0 start-0 m-3 z-2",children:(0,s.jsx)(h.Z,{style:"available"===e.status?N.pillBadge:N.secondaryBadge,className:"opacity-90",children:"available"===e.status?"Available":"Claimed"})}),(0,s.jsx)("div",{className:"position-absolute bottom-0 start-0 m-3 z-2",children:(0,s.jsx)("span",{style:N.quantityBadge,className:"d-inline-block",children:e.quantity})})]}):(0,s.jsxs)("div",{className:"bg-light d-flex align-items-center justify-content-center h-100",style:{minHeight:"200px",borderRadius:"16px 0 0 16px"},children:[(0,s.jsx)("div",{style:{...N.cardOverlay,borderRadius:"16px 0 0 16px"}}),(0,s.jsxs)("div",{className:"position-relative z-3 text-center p-3",children:[(0,s.jsx)("div",{className:"bg-white rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"},children:(0,s.jsx)("span",{className:"material-symbols-outlined fs-3 text-secondary",children:"restaurant"})}),(0,s.jsx)("p",{className:"text-white mb-0 small",children:"No image"})]}),(0,s.jsx)("div",{className:"position-absolute top-0 start-0 m-3 z-2",children:(0,s.jsx)(h.Z,{style:"available"===e.status?N.pillBadge:N.secondaryBadge,className:"opacity-90",children:"available"===e.status?"Available":"Claimed"})}),(0,s.jsx)("div",{className:"position-absolute bottom-0 start-0 m-3 z-2",children:(0,s.jsx)("span",{style:N.quantityBadge,className:"d-inline-block",children:e.quantity})})]})}),(0,s.jsx)(c.Z,{md:9,children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[(0,s.jsx)("h5",{style:N.cardTitle,className:"mb-0",children:e.title}),(0,s.jsxs)("div",{style:N.distanceBadge,children:[(0,s.jsx)(y.Nh4,{className:"me-1",style:{fontSize:"0.7rem"}})," ",e.distance," km"]})]}),(0,s.jsx)("p",{style:N.cardText,className:"mb-4",children:e.description.length>200?"".concat(e.description.substring(0,200),"..."):e.description}),(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:"col-lg-8",children:[(0,s.jsxs)("div",{className:"d-flex mb-3",children:[(0,s.jsx)("div",{style:N.avatarCircle,className:"me-3",children:(0,s.jsx)(y.Nh4,{className:"text-primary fs-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.85rem"},children:"Location"}),(0,s.jsx)("div",{style:{fontWeight:"500"},children:e.location&&"object"==typeof e.location?e.location.address:String(e.location)})]})]}),(0,s.jsxs)("div",{className:"d-flex mb-3",children:[(0,s.jsx)("div",{style:N.avatarCircleWarning,className:"me-3",children:(0,s.jsx)(y.IiJ,{className:"text-warning fs-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.85rem"},children:"Expires in"}),(0,s.jsx)("div",{className:"text-warning fw-bold",children:X(e.expiryTime)})]})]}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"mb-3 d-flex flex-wrap",children:e.tags.map(e=>(0,s.jsx)(h.Z,{bg:"light",text:"dark",className:"me-2 mb-2 text-capitalize",style:N.pillBadge,children:e},e))})]}),(0,s.jsxs)("div",{className:"col-lg-4 d-flex flex-column justify-content-between",children:[(0,s.jsxs)("div",{className:"d-flex align-items-center mb-3",children:[(0,s.jsx)("div",{className:"rounded-circle bg-primary bg-opacity-10 p-2 me-2",style:N.avatarCircle,children:(0,s.jsx)("span",{className:"text-primary fw-bold",children:e.postedByName.charAt(0)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-primary fw-semibold",children:e.postedByName}),(0,s.jsx)("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:K(e.createdAt)})]})]}),(0,s.jsx)(o.Z,{variant:"available"===e.status?"success":"secondary",className:"py-2 d-flex align-items-center justify-content-center w-100",onClick:()=>{F(e),A(!0)},disabled:"available"!==e.status,style:{..."available"===e.status?N.claimButton:{},..."available"===e.status&&G===e.id?N.claimButtonHover:{}},children:"available"===e.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"material-symbols-outlined me-2",children:"shopping_cart_checkout"}),"Claim Now"]}):"Already Claimed"})]})]})]})})]})})},e.id))}),(0,s.jsxs)(p.Z,{show:R,onHide:()=>A(!1),children:[(0,s.jsx)(p.Z.Header,{closeButton:!0,children:(0,s.jsx)(p.Z.Title,{children:"Claim Food Donation"})}),(0,s.jsx)(p.Z.Body,{children:E&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h5",{className:"mb-3",children:E.title}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)("p",{children:E.description})}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Quantity:"})," ",E.quantity]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Posted by:"})," ",E.postedByName]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Location:"}),"\xa0",E.location&&"object"==typeof E.location?E.location.address:String(E.location),E.distance&&" (".concat(E.distance," km)")]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{children:"Expires:"})," ",E.expiryTime.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),(0,s.jsxs)(m.Z.Group,{className:"mb-3",children:[(0,s.jsx)(m.Z.Label,{children:"Add a note (optional)"}),(0,s.jsx)(m.Z.Control,{as:"textarea",rows:3,value:I,onChange:e=>z(e.target.value),placeholder:"Add any details about your pickup plans, questions for the donor, etc."})]})]})}),(0,s.jsxs)(p.Z.Footer,{children:[(0,s.jsx)(o.Z,{variant:"secondary",onClick:()=>A(!1),children:"Cancel"}),(0,s.jsx)(o.Z,{variant:"success",onClick:ee,disabled:W,children:W?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Claiming..."]}):"Confirm Claim"})]})]})]})})}},9834:function(e,a,t){"use strict";t.d(a,{E4:function(){return n},d4:function(){return l},hj:function(){return o},oS:function(){return d}});var s=t(109),i=t(6650),r=t(8882);let l=async(e,a)=>{console.log("Creating food post with data:",e),console.log("Posted by user ID:",e.postedBy);try{let t="";if(a){console.log("Uploading image to Firebase Storage");let e=Date.now(),s=Math.random().toString(36).substring(2,10),l="".concat(e,"-").concat(s,"-").concat(a.name),n=(0,i.iH)(r.tO,"food-images/".concat(l)),o=new Promise(async(e,t)=>{try{if(a.size>5242880)throw Error("Image file is too large. Maximum size is 5MB.");let t={contentType:a.type,cacheControl:"public,max-age=86400"},s=await (0,i.KV)(n,a,t);console.log("Image uploaded successfully");let r=await (0,i.Jt)(s.ref);e(r)}catch(e){console.error("Error in image upload process:",e),t(e)}}),d=new Promise((e,a)=>{setTimeout(()=>{a(Error("Image upload timed out. Please try again with a smaller image."))},6e4)});try{t=await Promise.race([o,d]),console.log("Image uploaded, URL:",t)}catch(e){throw console.error("Image upload failed:",e),e}}let l={...e,imageUrl:t,status:"available",createdAt:(0,s.Bt)(),preparedTime:s.EK.fromDate(e.preparedTime),expiryTime:s.EK.fromDate(e.expiryTime)};console.log("Adding food post to Firestore with final data:",l);let n=await (0,s.ET)((0,s.hJ)(r.db,"foodPosts"),l);return console.log("Adding safety checklist to Firestore"),await (0,s.ET)((0,s.hJ)(r.db,"safetyChecklists"),{...e.checklist,foodId:n.id,createdAt:(0,s.Bt)()}),console.log("Food post created successfully with ID:",n.id),n.id}catch(e){throw console.error("Error creating food post:",e),e}},n=async e=>{try{console.log("Getting food posts from Firestore with filters:",e);let a=(0,s.hJ)(r.db,"foodPosts"),t=[];(null==e?void 0:e.status)&&(t.push((0,s.ar)("status","==",e.status)),console.log("Added status filter:",e.status)),(null==e?void 0:e.foodType)==="vegetarian"?(t.push((0,s.ar)("isVegetarian","==",!0)),console.log("Added vegetarian filter")):(null==e?void 0:e.foodType)==="non-vegetarian"?(t.push((0,s.ar)("isNonVegetarian","==",!0)),console.log("Added non-vegetarian filter")):(null==e?void 0:e.foodType)==="gluten-free"&&(t.push((0,s.ar)("isGlutenFree","==",!0)),console.log("Added gluten-free filter")),(null==e?void 0:e.userId)&&(console.log("Adding postedBy filter with user ID:",e.userId),t.push((0,s.ar)("postedBy","==",e.userId))),t.push((0,s.Xo)("createdAt","desc")),console.log("Added orderBy createdAt desc"),console.log("Final query constraints:",JSON.stringify(t));let i=await (0,s.PL)((0,s.IO)(a,...t));console.log("Found ".concat(i.size," food posts in Firestore")),0===i.size&&console.log("No posts found. Collection might be empty or filters too restrictive");let l=[];for(let a of i.docs){let t=a.data(),i=(0,s.IO)((0,s.hJ)(r.db,"safetyChecklists"),(0,s.ar)("foodId","==",a.id),(0,s.b9)(1)),n=await (0,s.PL)(i),o=null;if(!n.empty){let e=n.docs[0].data();o={id:n.docs[0].id,foodId:a.id,hygieneRating:e.hygieneRating,properStorage:e.properStorage,safeTemperature:e.safeTemperature,handlingProcedures:e.handlingProcedures,notes:e.notes}}let d={id:a.id,title:t.title,quantity:t.quantity,description:t.description,imageUrl:t.imageUrl,preparedTime:t.preparedTime.toDate(),expiryTime:t.expiryTime.toDate(),location:t.location,isVegetarian:t.isVegetarian,isNonVegetarian:t.isNonVegetarian,isGlutenFree:t.isGlutenFree,postedBy:t.postedBy,postedByName:t.postedByName,status:t.status,createdAt:t.createdAt?t.createdAt.toDate():new Date,checklist:o};if(null==e?void 0:e.nearExpiry){let e=new Date,a=d.expiryTime,t=new Date(e.getTime()+108e5);a<t&&a>e&&l.push(d)}else l.push(d)}return l}catch(e){throw console.error("Error fetching food posts:",e),e}},o=async e=>{try{console.log("Deleting food post with ID:",e),await (0,s.oe)((0,s.JU)(r.db,"foodPosts",e));let a=(0,s.IO)((0,s.hJ)(r.db,"safetyChecklists"),(0,s.ar)("foodId","==",e),(0,s.b9)(1)),t=await (0,s.PL)(a);t.empty||await (0,s.oe)((0,s.JU)(r.db,"safetyChecklists",t.docs[0].id)),console.log("Food post and related documents deleted successfully")}catch(e){throw console.error("Error deleting food post:",e),e}},d=async(e,a)=>{try{console.log("Updating food post ".concat(e," status to: ").concat(a));let t=(0,s.JU)(r.db,"foodPosts",e);await (0,s.r7)(t,{status:a}),console.log("Food post status updated successfully")}catch(e){throw console.error("Error updating food post status:",e),e}}}},function(e){e.O(0,[445,999,330,728,697,628,888,774,179],function(){return e(e.s=8341)}),_N_E=e.O()}]);