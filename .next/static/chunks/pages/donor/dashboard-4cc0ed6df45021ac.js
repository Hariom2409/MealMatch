(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{2358:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/donor/dashboard",function(){return t(5924)}])},4268:function(e,s,t){"use strict";var i=t(5893);t(7294);var a=t(7375),l=t(9101),r=t(8070),d=t(2121),n=t(6720),c=t(1664),o=t.n(c),m=t(6197);s.Z=e=>{let{children:s,requireVerified:t=!0}=e,{currentUser:c,isEmailVerified:h}=(0,m.a)();return c?t&&!h()?(0,i.jsx)(a.Z,{className:"py-5",children:(0,i.jsx)(l.Z,{className:"justify-content-center",children:(0,i.jsx)(r.Z,{md:6,children:(0,i.jsx)(d.Z,{className:"shadow-sm",children:(0,i.jsxs)(d.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h4",{children:"Email Verification Required"}),(0,i.jsxs)("p",{className:"text-muted mb-3",children:["Please verify your email address ",(0,i.jsx)("strong",{children:c.email})," to continue."]}),(0,i.jsx)("div",{className:"d-grid gap-2",children:(0,i.jsx)(o(),{href:"/verify-email",passHref:!0,children:(0,i.jsx)(n.Z,{variant:"primary",children:"Verify Email"})})})]})})})})}):(0,i.jsx)(i.Fragment,{children:s}):(0,i.jsx)(a.Z,{className:"py-5",children:(0,i.jsx)(l.Z,{className:"justify-content-center",children:(0,i.jsx)(r.Z,{md:6,children:(0,i.jsx)(d.Z,{className:"shadow-sm",children:(0,i.jsxs)(d.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h4",{children:"Please Log In"}),(0,i.jsx)("p",{className:"text-muted",children:"You need to be logged in to access this page."}),(0,i.jsx)(o(),{href:"/login",passHref:!0,children:(0,i.jsx)(n.Z,{variant:"primary",children:"Go to Login"})})]})})})})})}},5924:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return U}});var i=t(5893),a=t(7294),l=t(3280),r=t(2121),d=t(6720),n=t(7375),c=t(6346),o=t(525),m=t(9101),h=t(8070),x=t(5166),u=t(3380),p=t(8287),j=t(7228),g=t(2914),y=t(1163),f=t(1664),N=t.n(f),v=t(3628),b=t(6197),w=t(9834),Z=t(4268);let k={marginBottom:"1rem",border:"none",borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},D={borderBottom:"none",backgroundColor:"transparent",padding:"1rem 1rem 0.5rem"},E={padding:"0.5rem 1rem"},T={borderTop:"none",backgroundColor:"transparent",padding:"0.5rem 1rem 1rem"},S={display:"flex",alignItems:"center",marginBottom:"0.5rem"},P={width:"100px",color:"#6c757d",fontWeight:"500",fontSize:"0.8rem"},A={flex:1,fontWeight:"500"},B=e=>new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=e=>{let s=Math.abs(new Date().getTime()-e.getTime()),t=Math.floor(s/36e5),i=Math.floor(s%36e5/6e4);if(t>24){let e=Math.floor(t/24);return"".concat(e," day").concat(1!==e?"s":""," ago")}return t>0?"".concat(t," hour").concat(1!==t?"s":""," ago"):"".concat(i," minute").concat(1!==i?"s":""," ago")},F=e=>{let{status:s}=e,t="primary",a=s,r=null;switch(s){case"available":t="success",a="Available",r=(0,i.jsx)(g.wEH,{size:10,className:"me-1"});break;case"claimed":t="warning",a="Claimed",r=(0,i.jsx)(g.fSQ,{size:10,className:"me-1"});break;case"picked_up":case"picked":t="primary",a="Picked Up",r=(0,i.jsx)(g.l_A,{size:10,className:"me-1"});break;case"expired":t="danger",a="Expired",r=(0,i.jsx)(g.gJy,{size:10,className:"me-1"})}return(0,i.jsxs)(l.Z,{bg:t,className:"d-inline-flex align-items-center py-2 px-3 rounded-pill",children:[r,(0,i.jsx)("span",{children:a})]})},I=()=>{let e=(0,y.useRouter)(),{currentUser:s}=(0,b.a)(),[t,l]=(0,a.useState)([]),[f,Z]=(0,a.useState)(!0),[I,U]=(0,a.useState)(null),[z,L]=(0,a.useState)(!1),[M,_]=(0,a.useState)(null),[J,K]=(0,a.useState)(!1),[q,V]=(0,a.useState)(!1);(0,a.useEffect)(()=>{{let e=window.matchMedia("(max-width: 768px)");V(e.matches);let s=e=>{V(e.matches)};return e.addEventListener("change",s),()=>e.removeEventListener("change",s)}},[]);let H=t.length,O=t.filter(e=>"available"===e.status).length,Q=t.filter(e=>"claimed"===e.status||"picked"===e.status).length,R=t.filter(e=>"expired"===e.status).length,G=async()=>{try{if(Z(!0),U(null),console.log("Fetching posts for user:",s),console.log("User ID:",null==s?void 0:s.id),!s||!s.id){U("You must be logged in to view your donations"),Z(!1);return}try{let e=await (0,w.E4)({userId:s.id});console.log("Fetched food posts with user filter:",e),console.log("Number of posts returned:",e.length);let t=await Promise.all(e.map(async e=>{let s=new Date;return"available"===e.status&&e.expiryTime<s&&(console.log("Post ".concat(e.id," has expired, updating status in Firestore")),await (0,w.oS)(e.id,"expired"),e.status="expired"),e}));l(t)}catch(i){console.error("Error with user filter, trying without filters:",i);let e=(await (0,w.E4)()).filter(e=>e.postedBy===s.id),t=await Promise.all(e.map(async e=>{let s=new Date;return"available"===e.status&&e.expiryTime<s&&(console.log("Post ".concat(e.id," has expired, updating status in Firestore")),await (0,w.oS)(e.id,"expired"),e.status="expired"),e}));console.log("Fetched all posts and filtered client-side:",t),console.log("Number of filtered posts:",t.length),l(t)}}catch(e){console.error("Error fetching food posts:",e),U("Failed to load your donations: "+(e.message||"Unknown error"))}finally{Z(!1)}};(0,a.useEffect)(()=>{if(!s){e.push("/login?redirect=/donor/dashboard");return}if("donor"!==s.role){e.push("/");return}G()},[s,e]);let X=e=>{_(e),L(!0)},W=async()=>{if(M)try{K(!0),await (0,w.hj)(M),l(e=>e.filter(e=>e.id!==M))}catch(e){console.error("Error deleting post:",e),U("Failed to delete post: "+(e.message||"Unknown error"))}finally{K(!1),L(!1),_(null)}},Y=s=>(0,i.jsxs)(r.Z,{style:k,children:[(0,i.jsx)(r.Z.Header,{style:D,children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[s.imageUrl&&(0,i.jsx)("div",{className:"me-3",children:(0,i.jsx)("img",{src:s.imageUrl,alt:s.title,width:"48",height:"48",className:"rounded-3 object-fit-cover",style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"mb-0 fw-semibold",children:s.title}),(0,i.jsx)("div",{className:"small text-muted",children:s.quantity})]})]})}),(0,i.jsxs)(r.Z.Body,{style:E,children:[(0,i.jsxs)("div",{style:S,children:[(0,i.jsx)("div",{style:P,children:"Posted:"}),(0,i.jsx)("div",{style:A,children:s.createdAt instanceof Date?s.createdAt.toLocaleDateString():new Date(s.createdAt).toLocaleDateString()})]}),(0,i.jsxs)("div",{style:S,children:[(0,i.jsx)("div",{style:P,children:"Expires:"}),(0,i.jsx)("div",{style:A,children:s.expiryTime instanceof Date?s.expiryTime.toLocaleDateString():new Date(s.expiryTime).toLocaleDateString()})]}),(0,i.jsxs)("div",{style:S,children:[(0,i.jsx)("div",{style:P,children:"Status:"}),(0,i.jsx)("div",{style:A,children:(0,i.jsx)(F,{status:s.status})})]})]}),(0,i.jsx)(r.Z.Footer,{style:T,children:(0,i.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[(0,i.jsxs)(d.Z,{size:"sm",variant:"outline-danger",onClick:()=>X(s.id),children:[(0,i.jsx)(g.Xm5,{className:"me-1"})," Delete"]}),(0,i.jsxs)(d.Z,{size:"sm",variant:"primary",onClick:()=>e.push("/donor/post/".concat(s.id)),children:[(0,i.jsx)(g.dSq,{className:"me-1"})," View"]})]})})]},s.id);return s&&"donor"===s.role?f?(0,i.jsx)(v.Z,{title:"Loading Dashboard - MealMatch",children:(0,i.jsxs)(n.Z,{className:"py-5 text-center",children:[(0,i.jsx)(c.Z,{animation:"border",variant:"success"}),(0,i.jsx)("p",{className:"mt-3",children:"Loading your dashboard..."})]})}):I?(0,i.jsx)(v.Z,{title:"Error - MealMatch",children:(0,i.jsx)(n.Z,{className:"py-5",children:(0,i.jsx)(o.Z,{variant:"danger",children:I})})}):(0,i.jsxs)(v.Z,{title:"Donor Dashboard - MealMatch",description:"Manage your food donations",children:[(0,i.jsxs)(n.Z,{fluid:!0,className:"py-4 px-4 px-lg-5",children:[(0,i.jsx)("div",{className:"bg-gradient-success rounded-3 shadow-sm p-4 mb-4 text-white",children:(0,i.jsxs)(m.Z,{className:"align-items-center",children:[(0,i.jsxs)(h.Z,{children:[(0,i.jsxs)("h1",{className:"display-6 fw-bold mb-1",children:["Welcome, ",s.name,"!"]}),(0,i.jsx)("p",{className:"lead mb-0",children:"Manage your food donations and track their status."})]}),(0,i.jsx)(h.Z,{xs:"auto",children:(0,i.jsxs)("div",{className:"d-flex gap-3",children:[(0,i.jsxs)(d.Z,{variant:"light",className:"shadow-sm",onClick:G,children:[(0,i.jsx)(g.fSQ,{className:"me-2"})," Refresh"]}),(0,i.jsxs)(d.Z,{variant:"light",className:"shadow-sm",onClick:()=>e.push("/donor/post"),children:[(0,i.jsx)(g.wEH,{className:"me-2"})," Post Food Donation"]})]})})]})}),(0,i.jsxs)(m.Z,{className:"g-4 mb-4",children:[(0,i.jsx)(h.Z,{sm:6,xl:3,children:(0,i.jsxs)(r.Z,{className:"border-0 shadow-sm h-100 rounded-3 position-relative overflow-hidden",children:[(0,i.jsx)("div",{className:"position-absolute bg-success opacity-10 rounded-circle",style:{width:"120px",height:"120px",top:"-30px",right:"-30px"}}),(0,i.jsxs)(r.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h3",{className:"display-4 fw-bold text-success",children:H}),(0,i.jsx)("p",{className:"mb-0 text-muted",children:"Total Donations"})]})]})}),(0,i.jsx)(h.Z,{sm:6,xl:3,children:(0,i.jsxs)(r.Z,{className:"border-0 shadow-sm h-100 rounded-3 position-relative overflow-hidden",children:[(0,i.jsx)("div",{className:"position-absolute bg-success opacity-10 rounded-circle",style:{width:"120px",height:"120px",top:"-30px",right:"-30px"}}),(0,i.jsxs)(r.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h3",{className:"display-4 fw-bold text-success",children:O}),(0,i.jsx)("p",{className:"mb-0 text-muted",children:"Active Listings"})]})]})}),(0,i.jsx)(h.Z,{sm:6,xl:3,children:(0,i.jsxs)(r.Z,{className:"border-0 shadow-sm h-100 rounded-3 position-relative overflow-hidden",children:[(0,i.jsx)("div",{className:"position-absolute bg-success opacity-10 rounded-circle",style:{width:"120px",height:"120px",top:"-30px",right:"-30px"}}),(0,i.jsxs)(r.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h3",{className:"display-4 fw-bold text-success",children:Q}),(0,i.jsx)("p",{className:"mb-0 text-muted",children:"Claimed/Picked Up"})]})]})}),(0,i.jsx)(h.Z,{sm:6,xl:3,children:(0,i.jsxs)(r.Z,{className:"border-0 shadow-sm h-100 rounded-3 position-relative overflow-hidden",children:[(0,i.jsx)("div",{className:"position-absolute bg-danger opacity-10 rounded-circle",style:{width:"120px",height:"120px",top:"-30px",right:"-30px"}}),(0,i.jsxs)(r.Z.Body,{className:"p-4 text-center",children:[(0,i.jsx)("h3",{className:"display-4 fw-bold text-danger",children:R}),(0,i.jsx)("p",{className:"mb-0 text-muted",children:"Expired"})]})]})})]}),(0,i.jsx)(r.Z,{className:"border-0 shadow-sm rounded-3 overflow-hidden",children:(0,i.jsx)(r.Z.Body,{className:"p-0",children:(0,i.jsxs)(x.Z.Container,{defaultActiveKey:"active",children:[(0,i.jsxs)(u.Z,{variant:"tabs",className:"border-bottom nav-tabs-modern",children:[(0,i.jsx)(u.Z.Item,{children:(0,i.jsx)(u.Z.Link,{eventKey:"active",className:"px-4 py-3 border-0 rounded-0 text-success",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"nav-icon-circle bg-success-subtle me-2 d-flex align-items-center justify-content-center",children:(0,i.jsx)(g.wEH,{size:14,className:"text-success"})}),"Active Listings"]})})}),(0,i.jsx)(u.Z.Item,{children:(0,i.jsx)(u.Z.Link,{eventKey:"scheduled",className:"px-4 py-3 border-0 rounded-0 text-warning",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"nav-icon-circle bg-warning-subtle me-2 d-flex align-items-center justify-content-center",children:(0,i.jsx)(g.fSQ,{size:14,className:"text-warning"})}),"Scheduled Pickups"]})})}),(0,i.jsx)(u.Z.Item,{children:(0,i.jsx)(u.Z.Link,{eventKey:"completed",className:"px-4 py-3 border-0 rounded-0 text-primary",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"nav-icon-circle bg-primary-subtle me-2 d-flex align-items-center justify-content-center",children:(0,i.jsx)(g.l_A,{size:14,className:"text-primary"})}),"Completed"]})})}),(0,i.jsx)(u.Z.Item,{children:(0,i.jsx)(u.Z.Link,{eventKey:"expired",className:"px-4 py-3 border-0 rounded-0 text-danger",children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[(0,i.jsx)("div",{className:"nav-icon-circle bg-danger-subtle me-2 d-flex align-items-center justify-content-center",children:(0,i.jsx)(g.gJy,{size:14,className:"text-danger"})}),"Expired"]})})})]}),(0,i.jsxs)(x.Z.Content,{children:[(0,i.jsx)(x.Z.Pane,{eventKey:"active",className:"p-4",children:0===t.filter(e=>"available"===e.status).length?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("div",{className:"empty-state-icon mb-4",children:(0,i.jsx)("div",{className:"bg-success-subtle p-3 d-inline-block rounded-circle mb-2",children:(0,i.jsx)(g.gJy,{size:36,className:"text-success"})})}),(0,i.jsx)("h3",{className:"h4 mb-3",children:"No Active Listings"}),(0,i.jsx)("p",{className:"text-muted mb-4 col-md-6 mx-auto",children:"You don't have any active food donations at the moment. Start sharing your extra food with those in need."}),(0,i.jsx)(N(),{href:"/donor/post",children:(0,i.jsxs)(d.Z,{variant:"success",className:"px-4 py-2 shadow-sm",children:[(0,i.jsx)(g.wEH,{className:"me-2"})," Create New Donation"]})})]}):q?(0,i.jsx)("div",{className:"p-3",children:t.filter(e=>"available"===e.status).map(e=>Y(e))}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)(p.Z,{hover:!0,className:"align-middle table-modern",children:[(0,i.jsx)("thead",{className:"text-muted",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Donation"}),(0,i.jsx)("th",{children:"Posted"}),(0,i.jsx)("th",{children:"Expires"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:t.filter(e=>"available"===e.status).map(e=>(0,i.jsxs)("tr",{className:"align-middle",children:[(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[e.imageUrl&&(0,i.jsx)("div",{className:"me-3",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.title,width:"48",height:"48",className:"rounded-3 object-fit-cover",style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"mb-1 fw-semibold",children:e.title}),(0,i.jsx)("div",{className:"small text-muted",children:e.quantity})]})]})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"small text-success",children:C(e.createdAt)})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center small",children:[(0,i.jsx)(g.fSQ,{className:"me-1 text-warning"}),(0,i.jsx)("span",{children:B(e.expiryTime)})]})}),(0,i.jsx)("td",{children:(0,i.jsx)(F,{status:e.status})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex",children:[(0,i.jsx)(N(),{href:"/donor/edit/".concat(e.id),children:(0,i.jsxs)(d.Z,{variant:"outline-primary",size:"sm",className:"me-2 rounded-pill px-3",children:[(0,i.jsx)(g.fmQ,{className:"me-1"})," Edit"]})}),(0,i.jsxs)(d.Z,{variant:"outline-danger",size:"sm",className:"rounded-pill px-3",onClick:()=>X(e.id),children:[(0,i.jsx)(g.Xm5,{className:"me-1"})," Delete"]})]})})]},e.id))})]})})}),(0,i.jsx)(x.Z.Pane,{eventKey:"scheduled",className:"p-4",children:0===t.filter(e=>"claimed"===e.status).length?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("div",{className:"empty-state-icon mb-4",children:(0,i.jsx)("div",{className:"bg-warning-subtle p-3 d-inline-block rounded-circle mb-2",children:(0,i.jsx)(g.fSQ,{size:36,className:"text-warning"})})}),(0,i.jsx)("h3",{className:"h4 mb-3",children:"No Scheduled Pickups"}),(0,i.jsx)("p",{className:"text-muted mb-4 col-md-6 mx-auto",children:"None of your donations have been claimed yet. Once recipients claim your food, they'll appear here."})]}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)(p.Z,{hover:!0,className:"align-middle table-modern",children:[(0,i.jsx)("thead",{className:"text-muted",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Donation"}),(0,i.jsx)("th",{children:"Claimed By"}),(0,i.jsx)("th",{children:"Pickup Time"}),(0,i.jsx)("th",{children:"Contact"}),(0,i.jsx)("th",{children:"Status"})]})}),(0,i.jsx)("tbody",{children:t.filter(e=>"claimed"===e.status).map(e=>(0,i.jsxs)("tr",{className:"align-middle",children:[(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[e.imageUrl&&(0,i.jsx)("div",{className:"me-3",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.title,width:"48",height:"48",className:"rounded-3 object-fit-cover",style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"mb-1 fw-semibold",children:e.title}),(0,i.jsx)("div",{className:"small text-muted",children:e.quantity})]})]})}),(0,i.jsx)("td",{children:e.claimedBy?e.claimedBy.name:"-"}),(0,i.jsx)("td",{children:e.pickupTime?(0,i.jsxs)("div",{className:"d-flex align-items-center small",children:[(0,i.jsx)(g.fSQ,{className:"me-1 text-warning"}),(0,i.jsx)("span",{children:B(e.pickupTime)})]}):"Not scheduled"}),(0,i.jsx)("td",{children:e.claimedBy?e.claimedBy.phone:"-"}),(0,i.jsx)("td",{children:(0,i.jsx)(F,{status:e.status})})]},e.id))})]})})}),(0,i.jsx)(x.Z.Pane,{eventKey:"completed",className:"p-4",children:0===t.filter(e=>"picked"===e.status).length?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("div",{className:"empty-state-icon mb-4",children:(0,i.jsx)("div",{className:"bg-primary-subtle p-3 d-inline-block rounded-circle mb-2",children:(0,i.jsx)(g.l_A,{size:36,className:"text-primary"})})}),(0,i.jsx)("h3",{className:"h4 mb-3",children:"No Completed Donations"}),(0,i.jsx)("p",{className:"text-muted mb-4 col-md-6 mx-auto",children:"None of your donations have been picked up yet. Once recipients collect your food, they'll appear here."})]}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)(p.Z,{hover:!0,className:"align-middle table-modern",children:[(0,i.jsx)("thead",{className:"text-muted",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Donation"}),(0,i.jsx)("th",{children:"Claimed By"}),(0,i.jsx)("th",{children:"Picked Up"}),(0,i.jsx)("th",{children:"Status"})]})}),(0,i.jsx)("tbody",{children:t.filter(e=>"picked"===e.status).map(e=>(0,i.jsxs)("tr",{className:"align-middle",children:[(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[e.imageUrl&&(0,i.jsx)("div",{className:"me-3",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.title,width:"48",height:"48",className:"rounded-3 object-fit-cover",style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"mb-1 fw-semibold",children:e.title}),(0,i.jsx)("div",{className:"small text-muted",children:e.quantity})]})]})}),(0,i.jsx)("td",{children:e.claimedBy?e.claimedBy.name:"-"}),(0,i.jsx)("td",{children:e.pickupTime?(0,i.jsxs)("div",{className:"d-flex align-items-center small",children:[(0,i.jsx)(g.l_A,{className:"me-1 text-primary"}),(0,i.jsx)("span",{children:B(e.pickupTime)})]}):"Not recorded"}),(0,i.jsx)("td",{children:(0,i.jsx)(F,{status:e.status})})]},e.id))})]})})}),(0,i.jsx)(x.Z.Pane,{eventKey:"expired",className:"p-4",children:0===t.filter(e=>"expired"===e.status).length?(0,i.jsxs)("div",{className:"text-center py-5",children:[(0,i.jsx)("div",{className:"empty-state-icon mb-4",children:(0,i.jsx)("div",{className:"bg-danger-subtle p-3 d-inline-block rounded-circle mb-2",children:(0,i.jsx)(g.gJy,{size:36,className:"text-danger"})})}),(0,i.jsx)("h3",{className:"h4 mb-3",children:"No Expired Donations"}),(0,i.jsx)("p",{className:"text-muted mb-4 col-md-6 mx-auto",children:"None of your donations have expired. Great job keeping your listings current!"})]}):(0,i.jsx)("div",{className:"table-responsive",children:(0,i.jsxs)(p.Z,{hover:!0,className:"align-middle table-modern",children:[(0,i.jsx)("thead",{className:"text-muted",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Donation"}),(0,i.jsx)("th",{children:"Posted"}),(0,i.jsx)("th",{children:"Expired"}),(0,i.jsx)("th",{children:"Status"}),(0,i.jsx)("th",{children:"Actions"})]})}),(0,i.jsx)("tbody",{children:t.filter(e=>"expired"===e.status).map(e=>(0,i.jsxs)("tr",{className:"align-middle",children:[(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center",children:[e.imageUrl&&(0,i.jsx)("div",{className:"me-3",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.title,width:"48",height:"48",className:"rounded-3 object-fit-cover",style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h6",{className:"mb-1 fw-semibold",children:e.title}),(0,i.jsx)("div",{className:"small text-muted",children:e.quantity})]})]})}),(0,i.jsx)("td",{children:(0,i.jsx)("div",{className:"small text-muted",children:C(e.createdAt)})}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"d-flex align-items-center small",children:[(0,i.jsx)(g.gJy,{className:"me-1 text-danger"}),(0,i.jsx)("span",{children:B(e.expiryTime)})]})}),(0,i.jsx)("td",{children:(0,i.jsx)(F,{status:e.status})}),(0,i.jsx)("td",{children:(0,i.jsxs)(d.Z,{variant:"outline-danger",size:"sm",className:"rounded-pill px-3",onClick:()=>X(e.id),children:[(0,i.jsx)(g.Xm5,{className:"me-1"})," Delete"]})})]},e.id))})]})})})]})]})})})]}),(0,i.jsxs)(j.Z,{show:z,onHide:()=>L(!1),centered:!0,children:[(0,i.jsx)(j.Z.Header,{closeButton:!0,className:"border-0 pb-0",children:(0,i.jsxs)(j.Z.Title,{className:"text-danger",children:[(0,i.jsx)(g.gJy,{className:"me-2"}),"Delete Donation"]})}),(0,i.jsxs)(j.Z.Body,{className:"pt-2",children:[(0,i.jsx)("p",{className:"mb-1",children:"Are you sure you want to delete this food donation?"}),(0,i.jsx)("p",{className:"text-muted small",children:"This action cannot be undone. All data associated with this donation will be permanently removed."})]}),(0,i.jsxs)(j.Z.Footer,{className:"border-0 pt-0",children:[(0,i.jsx)(d.Z,{variant:"light",onClick:()=>L(!1),children:"Cancel"}),(0,i.jsx)(d.Z,{variant:"danger",onClick:W,disabled:J,className:"px-4",children:J?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Deleting..."]}):"Delete"})]})]})]}):(0,i.jsx)(v.Z,{title:"Loading - MealMatch",children:(0,i.jsx)(n.Z,{className:"py-5 text-center",children:(0,i.jsx)(c.Z,{animation:"border",variant:"success"})})})};function U(){return(0,i.jsx)(Z.Z,{requireVerified:!0,children:(0,i.jsx)(I,{})})}},9834:function(e,s,t){"use strict";t.d(s,{E4:function(){return d},d4:function(){return r},hj:function(){return n},oS:function(){return c}});var i=t(109),a=t(6650),l=t(8882);let r=async(e,s)=>{console.log("Creating food post with data:",e),console.log("Posted by user ID:",e.postedBy);try{let t="";if(s){console.log("Uploading image to Firebase Storage");let e=Date.now(),i=Math.random().toString(36).substring(2,10),r="".concat(e,"-").concat(i,"-").concat(s.name),d=(0,a.iH)(l.tO,"food-images/".concat(r)),n=new Promise(async(e,t)=>{try{if(s.size>5242880)throw Error("Image file is too large. Maximum size is 5MB.");let t={contentType:s.type,cacheControl:"public,max-age=86400"},i=await (0,a.KV)(d,s,t);console.log("Image uploaded successfully");let l=await (0,a.Jt)(i.ref);e(l)}catch(e){console.error("Error in image upload process:",e),t(e)}}),c=new Promise((e,s)=>{setTimeout(()=>{s(Error("Image upload timed out. Please try again with a smaller image."))},6e4)});try{t=await Promise.race([n,c]),console.log("Image uploaded, URL:",t)}catch(e){throw console.error("Image upload failed:",e),e}}let r={...e,imageUrl:t,status:"available",createdAt:(0,i.Bt)(),preparedTime:i.EK.fromDate(e.preparedTime),expiryTime:i.EK.fromDate(e.expiryTime)};console.log("Adding food post to Firestore with final data:",r);let d=await (0,i.ET)((0,i.hJ)(l.db,"foodPosts"),r);return console.log("Adding safety checklist to Firestore"),await (0,i.ET)((0,i.hJ)(l.db,"safetyChecklists"),{...e.checklist,foodId:d.id,createdAt:(0,i.Bt)()}),console.log("Food post created successfully with ID:",d.id),d.id}catch(e){throw console.error("Error creating food post:",e),e}},d=async e=>{try{console.log("Getting food posts from Firestore with filters:",e);let s=(0,i.hJ)(l.db,"foodPosts"),t=[];(null==e?void 0:e.status)&&(t.push((0,i.ar)("status","==",e.status)),console.log("Added status filter:",e.status)),(null==e?void 0:e.foodType)==="vegetarian"?(t.push((0,i.ar)("isVegetarian","==",!0)),console.log("Added vegetarian filter")):(null==e?void 0:e.foodType)==="non-vegetarian"?(t.push((0,i.ar)("isNonVegetarian","==",!0)),console.log("Added non-vegetarian filter")):(null==e?void 0:e.foodType)==="gluten-free"&&(t.push((0,i.ar)("isGlutenFree","==",!0)),console.log("Added gluten-free filter")),(null==e?void 0:e.userId)&&(console.log("Adding postedBy filter with user ID:",e.userId),t.push((0,i.ar)("postedBy","==",e.userId))),t.push((0,i.Xo)("createdAt","desc")),console.log("Added orderBy createdAt desc"),console.log("Final query constraints:",JSON.stringify(t));let a=await (0,i.PL)((0,i.IO)(s,...t));console.log("Found ".concat(a.size," food posts in Firestore")),0===a.size&&console.log("No posts found. Collection might be empty or filters too restrictive");let r=[];for(let s of a.docs){let t=s.data(),a=(0,i.IO)((0,i.hJ)(l.db,"safetyChecklists"),(0,i.ar)("foodId","==",s.id),(0,i.b9)(1)),d=await (0,i.PL)(a),n=null;if(!d.empty){let e=d.docs[0].data();n={id:d.docs[0].id,foodId:s.id,hygieneRating:e.hygieneRating,properStorage:e.properStorage,safeTemperature:e.safeTemperature,handlingProcedures:e.handlingProcedures,notes:e.notes}}let c={id:s.id,title:t.title,quantity:t.quantity,description:t.description,imageUrl:t.imageUrl,preparedTime:t.preparedTime.toDate(),expiryTime:t.expiryTime.toDate(),location:t.location,isVegetarian:t.isVegetarian,isNonVegetarian:t.isNonVegetarian,isGlutenFree:t.isGlutenFree,postedBy:t.postedBy,postedByName:t.postedByName,status:t.status,createdAt:t.createdAt?t.createdAt.toDate():new Date,checklist:n};if(null==e?void 0:e.nearExpiry){let e=new Date,s=c.expiryTime,t=new Date(e.getTime()+108e5);s<t&&s>e&&r.push(c)}else r.push(c)}return r}catch(e){throw console.error("Error fetching food posts:",e),e}},n=async e=>{try{console.log("Deleting food post with ID:",e),await (0,i.oe)((0,i.JU)(l.db,"foodPosts",e));let s=(0,i.IO)((0,i.hJ)(l.db,"safetyChecklists"),(0,i.ar)("foodId","==",e),(0,i.b9)(1)),t=await (0,i.PL)(s);t.empty||await (0,i.oe)((0,i.JU)(l.db,"safetyChecklists",t.docs[0].id)),console.log("Food post and related documents deleted successfully")}catch(e){throw console.error("Error deleting food post:",e),e}},c=async(e,s)=>{try{console.log("Updating food post ".concat(e," status to: ").concat(s));let t=(0,i.JU)(l.db,"foodPosts",e);await (0,i.r7)(t,{status:s}),console.log("Food post status updated successfully")}catch(e){throw console.error("Error updating food post status:",e),e}}}},function(e){e.O(0,[445,999,330,146,628,888,774,179],function(){return e(e.s=2358)}),_N_E=e.O()}]);